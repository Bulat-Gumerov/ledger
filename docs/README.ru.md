# ledger
ledger - это проект для учета личных финансов

*[English](README.md), [Русский](README.ru.md)*

Он создавался чтобы учитывать личные доходы/расходы и инвестиции с актуальной информацией о состоянии счетов и оценочной стоимости портфеля ценных бумаг.

### Основные возможности
- ведение учета по нескольким счетам в разных валютах (основная валюта на данный момент - российскй рубль, в будущем планируетя добавть настройку основной валюты)
- 5 типов операций: 
    1. Обычный доход/расход, который может быть разделён на несколько категорий
    2. Перевод денежных средств между разными счетами и валютами
    3. Операции Покупки/Продажи ценных бумаг (в будущем планируется добавить операции слияния/деления компаний/акций)
    4. Дивиденды по акциям (Купоны по облигациям могут учитываться аналогичным образом)
    5. Корпоративные события для акций (Сплит, Смена символа, Выделение/Объединение компаний)
- основные отчеты:
    1. помесячный отчет доходов/расходов по категориям
    2. отчет о прибылях/убытках для инвестиционных счетов
    3. отчет по завершённым сделкам с ценными бумагами
- обновление котировок для американских (Yahoo), европейских (Euronext) и российских (MOEX) ценных бумаг 
- импорт брокерских отчетов в формате Quik HTML для российских брокеров (КИТ-Финанс, Уралсиб брокер) и XML flex-отчетов для Interactive Brokers
- налоговый отчет для подготовки декларации 3-НДФЛ по результатам операций с зарубежными ЦБ
- *экспериментальная* функция загрузки электронных чеков с сайта ФНС:
    1. QR-код может быть отсканирован камерой, либо распознан с изображения в буфере обмена или файле
    2. Для скачивания чеков нужна авторизация на сайте ФНС - программа поддерживает авторизацию через логин/пароль личного кабинете или Госуслуги (Пароли не сохраняются в программе, сохраняется только ID-сессии - можете проверить по исходному коду)


### Установка
ledger создавался как переносимое приложение - поэтому он не требует каких-то специфичных инструкций по установке. Все что вам нужно - это иметь Python 3.8.1 или выше и установленные пакеты из раздела Зависимости.
Далее вам нужно скачать/клонировать код из [GitHub репозитория](https://github.com/titov-vv/ledger) и запустить программу с помощью команды: `main.py` на Windows или `./main.py` на Linux, либо вы можете запустить файл просто двойным кликом на нём если ваша система сконфирурирована запускать Python-скрипты таким образом.
База данных программы будет инициализирована автоматически минимально необходимым набором данных и вы сможете начать использовать приложение.

Для смены языка с Английского на Русский нужно выбрать пункт меню Languages->Russian и перезапустить программу

### Обновление на новую версию
После перехода на новую версию приложения вы можете получить сообщение _"Database schema version is outdated. Please execute update script."_
В этом случае вам необходимо воспользоваться скриптом `update_db_schema.py` из папки updates. Пример использования скрипта в Linux:

`./update_db_schema.py ../ledger.sqlite`

Данный скрипт внесёт необходимые изменения в ваш файл с данными (как обычно, рекомендуется сделать резервную копию вашего файла `ledger.sqlite` перед любыми манипуляциями)

### Зависимости
ledger использует следующие пакеты для своей работы:
* [Qt for Python (PySide2)](https://wiki.qt.io/Qt_for_Python) *>=5.15* - графический интерфейс приложения (с версиями ниже 5.15 могут наблюдаться проблемы)
* [pandas](https://pandas.pydata.org/) - различные операции с данными
* [lxml](https://lxml.de/) - зависиомость pandas для метода read_html() (но почему-то не установилась автоматически под Windows)
* [requests](https://requests.readthedocs.io/) - обновление котировок через интернет; загрузка электронных чеков
* [xlsxwriter](https://xlsxwriter.readthedocs.io/) - эспорт отчетов в формате Excel
* [ibflex](https://github.com/csingley/ibflex) *>=0.14* - импорт flex-отчетов Interactive Brokers
* [pyzbar](https://github.com/NaturalHistoryMuseum/pyzbar/) <sup>1</sup> - распознавание QR-кодов электронных чеков
* [Pillow](https://pillow.readthedocs.io/en/stable/) <sup>1</sup> - работа с изображениями
* [tensorflow](https://www.tensorflow.org/) <sup>2</sup> - автоматическое распознавание категорий 

<sup>1</sup> - необязательные зависимости (распознавание чеков будет недоступно)  
<sup>2</sup> - зависимость для эксперементальной функции (распознавание категорий будет недоступно)


### Скриншоты
Основные скриншоты можно посмотреть на англоязычной версии данной страницы - они отличаются только языком.
Ниже представлены скриншоты функционала актуального только для России.

##### *Отчет по операциям с иностранными ценными бумагами*

Отчет в виде файла Excel доступен по [ссылке](https://github.com/titov-vv/ledger/tree/master/docs/tax_rus_example.xlsx).    
Пример страницы с отчетом о дивидендах:  
![rus_tax_dividends](https://github.com/titov-vv/ledger/blob/master/screenshots/tax_rus_dividends.png?raw=true)

Пример страницы с отчетом о сделках с иностранными ЦБ:  
![rus_tax_deals](https://github.com/titov-vv/ledger/blob/master/screenshots/tax_rus_deals.png?raw=true)

Пример страницы с отчетом о комиссиях брокера:  
![rus_tax_fees](https://github.com/titov-vv/ledger/blob/master/screenshots/tax_rus_fees.png?raw=true)

##### *Загрузка электронных чеков с сайта ФНС*

Диалог авторизации (выбрана страница с авторизацией через Госуслуги):  
![FSN authorization dialog](https://github.com/titov-vv/ledger/blob/master/screenshots/fns_auth_dialog.png?raw=true)

Диалог импорта чека:  
![Electronic slip import dialog](https://github.com/titov-vv/ledger/blob/master/screenshots/slip_import.png?raw=true) 

